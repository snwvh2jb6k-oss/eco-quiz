<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìƒíƒœÂ·í™˜ê²½ í€´ì¦ˆ - 10ë¬¸ì œ</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1: #0f172a;
    --bg2: #083344;
    --card: rgba(255,255,255,0.06);
    --accent: #2ee6a7;
    --accent-2: #6be7ff;
    --muted: rgba(255,255,255,0.7);
    --glass: rgba(255,255,255,0.04);
    --success: #6ee7b7;
    --danger: #ff7a7a;
    --max-width: 1100px;
  }

  html,body{
    height:100%;
    margin:0;
    font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;
    background: linear-gradient(180deg,var(--bg1) 0%, #05202a 60%);
    color: white;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Full-screen layout */
  .app{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:32px;
    box-sizing:border-box;
  }

  .container{
    width:100%;
    max-width:var(--max-width);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:18px;
    box-shadow: 0 10px 30px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
    overflow:hidden;
    display:grid;
    grid-template-columns: 420px 1fr;
    gap:0;
    min-height:70vh;
  }

  /* Left panel - visual */
  .left{
    padding:36px;
    background: linear-gradient(180deg, rgba(10,30,30,0.6), rgba(5,20,23,0.9));
    display:flex;
    flex-direction:column;
    gap:18px;
    align-items:flex-start;
    justify-content:center;
  }
  .logo{
    display:flex;
    align-items:center;
    gap:12px;
  }
  .logo .mark{
    width:64px;
    height:64px;
    border-radius:14px;
    background: conic-gradient(from 120deg, var(--accent), var(--accent-2), #7b9cff);
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    color:#042022;
    box-shadow: 0 6px 18px rgba(46,230,167,0.12);
  }
  .title{
    font-size:20px;
    font-weight:700;
    letter-spacing:-0.02em;
  }
  .subtitle{
    color:var(--muted);
    font-size:13px;
    line-height:1.45;
  }

  .progress-wrap{
    width:100%;
    margin-top:12px;
  }
  .progress{
    height:12px;
    background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border-radius:999px;
    overflow:hidden;
  }
  .progress > i{
    display:block;
    height:100%;
    width:0%;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    border-radius:999px;
    transition:width 450ms cubic-bezier(.2,.9,.2,1);
    box-shadow: 0 6px 18px rgba(107,231,255,0.06);
  }
  .meta{
    display:flex;
    width:100%;
    justify-content:space-between;
    font-size:13px;
    margin-top:10px;
    color:var(--muted);
  }

  /* Right panel - quiz area */
  .right{
    padding:36px;
    display:flex;
    flex-direction:column;
    gap:18px;
    position:relative;
    background:
      radial-gradient(600px 200px at 10% 10%, rgba(107,231,255,0.03), transparent 10%),
      radial-gradient(400px 140px at 80% 90%, rgba(46,230,167,0.03), transparent 10%);
  }

  .card{
    background: var(--card);
    border-radius:12px;
    padding:22px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    border:1px solid rgba(255,255,255,0.03);
  }

  .question-head{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }
  .q-index{
    font-size:14px;
    color:var(--muted);
  }
  .q-text{
    margin-top:10px;
    font-size:20px;
    line-height:1.35;
    font-weight:600;
  }

  .choices{
    display:grid;
    gap:12px;
    margin-top:16px;
  }
  .choice{
    padding:14px 16px;
    border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border:1px solid rgba(255,255,255,0.03);
    cursor:pointer;
    transition: transform 150ms ease, box-shadow 150ms ease;
    display:flex;
    align-items:center;
    gap:12px;
    user-select:none;
  }
  .choice:hover{ transform:translateY(-4px); box-shadow: 0 12px 26px rgba(2,6,23,0.6); }
  .choice .label{
    min-width:38px;
    height:38px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:8px;
    background: rgba(255,255,255,0.02);
    font-weight:700;
  }
  .choice .txt{ font-size:15px; color:var(--muted); }

  .choice.correct{
    border-color: rgba(110,231,183,0.25);
    background: linear-gradient(90deg, rgba(110,231,183,0.06), rgba(46,230,167,0.03));
    box-shadow: 0 10px 30px rgba(46,230,167,0.06);
  }
  .choice.wrong{
    border-color: rgba(255,122,122,0.15);
    background: linear-gradient(90deg, rgba(255,122,122,0.03), rgba(255,122,122,0.01));
  }

  .explain{
    margin-top:12px;
    font-size:13px;
    color:var(--muted);
    display:none;
  }
  .explain.show{ display:block; }

  .controls{
    display:flex;
    gap:12px;
    justify-content:space-between;
    align-items:center;
    margin-top:12px;
  }

  .btn{
    background: linear-gradient(90deg,var(--accent),var(--accent-2));
    color:#042022;
    padding:10px 16px;
    border-radius:10px;
    border:none;
    font-weight:700;
    cursor:pointer;
    box-shadow: 0 8px 20px rgba(46,230,167,0.08);
  }
  .btn.ghost{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.04);
    font-weight:600;
  }
  .small{
    font-size:13px;
    padding:9px 12px;
    border-radius:9px;
  }

  .footer{
    margin-top:auto;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    color:var(--muted);
    font-size:13px;
  }

  /* result overlay */
  .overlay{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.8));
    z-index:30;
    padding:40px;
    box-sizing:border-box;
    opacity:0;
    pointer-events:none;
    transition:opacity 300ms ease;
  }
  .overlay.show{ opacity:1; pointer-events:auto; }

  .result{
    max-width:680px;
    width:100%;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:28px;
    text-align:center;
    box-shadow: 0 20px 50px rgba(2,6,23,0.6);
  }
  .result h2{ margin:0; font-size:28px; }
  .score{
    font-size:56px;
    margin:14px 0 6px 0;
    font-weight:800;
  }
  .share{
    margin-top:12px;
    display:flex;
    gap:10px;
    justify-content:center;
  }

  /* confetti canvas */
  #confetti{
    position:absolute;
    inset:0;
    pointer-events:none;
    z-index:40;
  }

  /* Responsive */
  @media (max-width:980px){
    .container{ grid-template-columns: 1fr; min-height:80vh; }
    .left{ order:2; padding:20px; align-items:center; text-align:center; }
    .right{ order:1; padding:20px; }
  }
</style>
</head>
<body>
<div class="app">
  <div class="container" role="application" aria-label="ìƒíƒœ í™˜ê²½ í€´ì¦ˆ ì•±">
    <div class="left">
      <div class="logo">
        <div class="mark">E</div>
        <div>
          <div class="title">EcoQuiz â€” ìƒíƒœÂ·í™˜ê²½ í€´ì¦ˆ</div>
          <div class="subtitle">ì¬ë¯¸ìˆê³  ì‰¬ìš´ 10ë¬¸ì œë¡œ í™˜ê²½ ì§€ì‹ì„ í™•ì¸í•´ë´!</div>
        </div>
      </div>

      <div class="card progress-wrap" aria-hidden="true">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div style="font-weight:700;">ì§„í–‰ë„</div>
          <div style="font-size:13px;color:var(--muted);" id="progressText">0 / 10</div>
        </div>
        <div class="progress" aria-hidden="true" style="margin-top:10px;">
          <i id="progressBar"></i>
        </div>
        <div class="meta">
          <div id="scoreMeta">ì ìˆ˜: 0</div>
          <div id="hintMeta">ê¸°ë¡: ì •ë‹µì„ ì„ íƒí•˜ë©´ í•´ì„¤ì´ í‘œì‹œë¨</div>
        </div>
      </div>

      <div style="margin-top:18px;color:var(--muted);font-size:13px;">
        â€¢ ê° ë¬¸ì œëŠ” 1ì . <br>
        â€¢ í‹€ë ¤ë„ ë‹¤ìŒ ë¬¸ì œë¡œ ì§„í–‰ ê°€ëŠ¥. ì •ë‹µì€ í•´ì„¤ë¡œ í™•ì¸ ê°€ëŠ¥. <br>
        â€¢ ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± ëª¨ë‘ ìµœì í™”.
      </div>
    </div>

    <div class="right">
      <canvas id="confetti"></canvas>

      <div class="card" id="quizCard" aria-live="polite">
        <div class="question-head">
          <div class="q-index" id="qIndex">ë¬¸ì œ 1</div>
          <div id="timer" style="color:var(--muted); font-size:13px;">â€”</div>
        </div>

        <div class="q-text" id="qText">ë¡œë”© ì¤‘...</div>

        <div class="choices" id="choices" role="listbox" aria-label="ë‹µ ì„ íƒ">
          <!-- choices injected here -->
        </div>

        <div class="explain card" id="explain"></div>

        <div class="controls">
          <div>
            <button class="btn ghost small" id="prevBtn" disabled>ì´ì „</button>
            <button class="btn ghost small" id="nextBtn">ë‹¤ìŒ</button>
          </div>
          <div>
            <button class="btn small" id="resetBtn">ë‹¤ì‹œí•˜ê¸°</button>
          </div>
        </div>
      </div>

      <div class="footer">
        <div>ì´ 10ë¬¸ì œ Â· ìì—°ê³¼ í™˜ê²½ì— ê´€í•œ ê¸°ì´ˆ ìƒì‹</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <div style="font-size:13px;color:var(--muted);">Made with ğŸŒ±</div>
        </div>
      </div>

      <!-- overlay result -->
      <div class="overlay" id="overlay" aria-hidden="true">
        <div class="result" role="dialog" aria-modal="true">
          <h2 id="resultTitle">ê²°ê³¼</h2>
          <div class="score" id="resultScore">0 / 10</div>
          <div id="resultText" style="color:var(--muted); margin-top:8px;">ì„¤ëª…</div>
          <div class="share">
            <button class="btn ghost small" id="reviewBtn">ë¬¸ì œ ë‹¤ì‹œë³´ê¸°</button>
            <button class="btn small" id="againBtn">ë‹¤ì‹œí’€ê¸°</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
/*
  EcoQuiz - 10 questions
  - Each question: {q, choices:[], answer: index, explain}
  - Single page app with state
*/

const questions = [
  {
    q: "ì§€êµ¬ ì˜¨ë‚œí™”ì˜ ì£¼ìš” ì›ì¸ìœ¼ë¡œ ê°€ì¥ í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€?",
    choices: ["ì˜¤ì¡´ì¸µ íŒŒê´´", "ì´ì‚°í™”íƒ„ì†Œ(COâ‚‚) ë“± ì˜¨ì‹¤ê°€ìŠ¤ ì¦ê°€", "ìì™¸ì„  ì¦ê°€", "ìì—°ì ì¸ ê¸°í›„ ë³€í™”"],
    answer: 1,
    explain: "ì‚°ì—…í˜ëª… ì´í›„ í™”ì„ì—°ë£Œ ì—°ì†Œ ë“±ìœ¼ë¡œ ëŒ€ê¸° ì¤‘ ì˜¨ì‹¤ê°€ìŠ¤ê°€ ì¦ê°€í•˜ë©´ì„œ ì§€êµ¬ í‰ê· ê¸°ì˜¨ì´ ìƒìŠ¹í–ˆìŒ."
  },
  {
    q: "ë‹¤ìŒ ì¤‘ ìƒë¬¼ ë‹¤ì–‘ì„±(Biodiversity)ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ìš”ì†ŒëŠ”?",
    choices: ["ìœ ì „ì ë‹¤ì–‘ì„±", "ì¢… ë‹¤ì–‘ì„±", "ìƒíƒœê³„ ë‹¤ì–‘ì„±", "ê¸°ì˜¨ì˜ ì¼ì‹œì  ë³€í™”"],
    answer: 3,
    explain: "ìƒë¬¼ë‹¤ì–‘ì„±ì€ ìœ ì „ì, ì¢…(ìƒë¬¼ì¢…), ìƒíƒœê³„ì˜ ë‹¤ì–‘ì„±ì„ í¬í•¨í•˜ë©°, ì¼ì‹œì  ê¸°í›„ ë³€ë™ì€ í¬í•¨ë˜ì§€ ì•ŠìŒ."
  },
  {
    q: "í”Œë¼ìŠ¤í‹± ì“°ë ˆê¸°ì˜ ë¶„í•´ì— ëŒ€í•´ ì˜³ì€ ì„¤ëª…ì€?",
    choices: ["ìì—°ì—ì„œ ë¹ ë¥´ê²Œ ë¶„í•´ë˜ì–´ ë¬´í•´í•´ì§„ë‹¤", "ì¼ë¶€ í”Œë¼ìŠ¤í‹±ì€ ìˆ˜ë°± ë…„ ë™ì•ˆ ë¶„í•´ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤", "ë°”ë‹¤ì— ë“¤ì–´ê°€ë©´ ê¸ˆë°© ì‚¬ë¼ì§„ë‹¤", "íƒœì›Œë„ í™˜ê²½ì— ì˜í–¥ì´ ì—†ë‹¤"],
    answer: 1,
    explain: "í´ë¦¬ì—í‹¸ë Œ ë“± í”Œë¼ìŠ¤í‹±ì€ ë¶„í•´ê°€ ë§¤ìš° ëŠë ¤ ìˆ˜ì‹­~ìˆ˜ë°± ë…„ ì”ì¡´í•˜ë©°, ë¯¸ì„¸í”Œë¼ìŠ¤í‹± ë¬¸ì œë¥¼ ìœ ë°œí•¨."
  },
  {
    q: "íƒ„ì†Œì¤‘ë¦½(Carbon Neutral)ì˜ ì˜ë¯¸ëŠ” ë¬´ì—‡ì¸ê°€?",
    choices: ["íƒ„ì†Œ ë°°ì¶œì„ ì „í˜€ í•˜ì§€ ì•ŠëŠ” ê²ƒ", "ë°°ì¶œí•œ íƒ„ì†Œë§Œí¼ í¡ìˆ˜í•˜ê±°ë‚˜ ìƒì‡„í•˜ì—¬ ìˆœ ë°°ì¶œì´ 0ì´ ë˜ëŠ” ê²ƒ", "íƒ„ì†Œë¥¼ ê¸ˆì§€í•˜ëŠ” ì •ì±…", "íƒ„ì†Œë¥¼ ë” ë§ì´ ë°°ì¶œí•˜ëŠ” ê²ƒ"],
    answer: 1,
    explain: "íƒ„ì†Œì¤‘ë¦½ì€ ë°°ì¶œëœ íƒ„ì†Œë¥¼ í¡ìˆ˜Â·ìƒì‡„í•´ ìˆœ ë°°ì¶œëŸ‰ì„ 0ìœ¼ë¡œ ë§Œë“œëŠ” ê°œë…ì„."
  },
  {
    q: "ì˜¤ì—¼ë¬¼ì§ˆì´ ë¨¹ì´ì‚¬ìŠ¬ì„ í†µí•´ ìƒìœ„ í¬ì‹ìë¡œ ë” ë†ì¶•ë˜ëŠ” í˜„ìƒì„ ë¬´ì—‡ì´ë¼ í•˜ëŠ”ê°€?",
    choices: ["ìƒë¬¼ë†ì¶•(Biomagnification)", "ë¶„í•´", "ìš©í•´", "íœ˜ë°œ"],
    answer: 0,
    explain: "ìƒë¬¼ë†ì¶•ì€ íŠ¹ì • ìœ í•´ë¬¼ì§ˆì´ ë¨¹ì´ì‚¬ìŠ¬ì„ ë”°ë¼ ìƒìœ„ í¬ì‹ìë¡œ ê°ˆìˆ˜ë¡ ë†ë„ê°€ ì¦ê°€í•˜ëŠ” í˜„ìƒì„."
  },
  {
    q: "ì‚°ì„±ë¹„ì˜ ì£¼ëœ ì›ì¸ì€ ë¬´ì—‡ì¸ê°€?",
    choices: ["ë¯¸ì„¸ë¨¼ì§€(PM10)", "ì§ˆì†Œì‚°í™”ë¬¼(NOx)ê³¼ í™©ì‚°í™”ë¬¼(SOx) ë“±ì˜ ëŒ€ê¸°ì˜¤ì—¼ë¬¼ì§ˆ", "ì˜¤ì¡´ì¸µ íŒŒê´´", "ìì™¸ì„  ì¦ê°€"],
    answer: 1,
    explain: "ì‚°ì„±ë¹„ëŠ” ì£¼ë¡œ í™”ì„ì—°ë£Œ ì—°ì†Œë¡œ ë°œìƒí•œ ì§ˆì†Œì‚°í™”ë¬¼ê³¼ í™©ì‚°í™”ë¬¼ì´ ë¬¼ê³¼ ë°˜ì‘í•´ ìƒê¹€."
  },
  {
    q: "ë„ì‹œì˜ ì—´ì„¬í˜„ìƒ(Urban Heat Island)ì„ ì¤„ì´ë ¤ë©´ ì–´ë–¤ ë°©ë²•ì´ íš¨ê³¼ì ì¸ê°€?",
    choices: ["ì•„ìŠ¤íŒ”íŠ¸ ë©´ì  í™•ëŒ€", "ë„ì‹¬ ë…¹ì§€(ë‚˜ë¬´, ì˜¥ìƒë…¹í™”) í™•ëŒ€", "ê±´ë¬¼ ìƒ‰ì„ ì–´ë‘¡ê²Œ ì¹ í•˜ê¸°", "ë‚˜ë¬´ ë² ì–´ë‚´ê¸°"],
    answer: 1,
    explain: "ë…¹ì§€ì™€ ìˆ˜ë©´ í™•ëŒ€, ë°˜ì‚¬ ì¬ë£Œ ì‚¬ìš© ë“±ì€ ì—´ì„¬ì„ ì™„í™”í•˜ëŠ” ë° ë„ì›€ì´ ë¨."
  },
  {
    q: "ì¬ìƒì—ë„ˆì§€ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²ƒì€?",
    choices: ["íƒœì–‘ê´‘", "í’ë ¥", "ì„íƒ„ ë°œì „", "ì§€ì—´"],
    answer: 2,
    explain: "ì„íƒ„ ë°œì „ì€ í™”ì„ì—°ë£Œ ê¸°ë°˜ìœ¼ë¡œ ì¬ìƒì—ë„ˆì§€ê°€ ì•„ë‹˜."
  },
  {
    q: "ë©¸ì¢…ìœ„ê¸°ì¢…ì„ ë³´í˜¸í•˜ëŠ” ë° ê°€ì¥ íš¨ê³¼ì ì¸ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€?",
    choices: ["ì„œì‹ì§€ ë³´ì „ê³¼ ë³µì›", "ì‚¬ëƒ¥ í—ˆìš©", "ì„œì‹ì§€ íŒŒê´´", "ìœ í•´ ë™ë¬¼ ë°©ì¹˜"],
    answer: 0,
    explain: "ì„œì‹ì§€ ë³´ì „Â·ë³µì›, ë°€ë µ ê¸ˆì§€, ìƒë¬¼ë‹¤ì–‘ì„± ë³´í˜¸ì •ì±…ì´ í•µì‹¬ì„."
  },
  {
    q: "ì§€ì†ê°€ëŠ¥í•œ ì†Œë¹„(Sustainable consumption)ì˜ ì˜ˆë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?",
    choices: ["ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì œí’ˆ ì‚¬ìš©", "ì§€ì—­ì‚° ì‹í’ˆ ì„ íƒ", "ê³¼ë„í•œ ì¼íšŒìš©í’ˆ ì‚¬ìš©", "ìˆ˜ë¦¬Â·ì¬í™œìš© ì„ íƒ"],
    answer: 2,
    explain: "ê³¼ë„í•œ ì¼íšŒìš©í’ˆ ì‚¬ìš©ì€ ì§€ì†ê°€ëŠ¥í•œ ì†Œë¹„ì˜ ë°˜ëŒ€ì„."
  }
];

let state = {
  idx: 0,
  answers: Array(questions.length).fill(null), // user selected index or null
  score: 0,
};

const qIndexEl = document.getElementById('qIndex');
const qTextEl = document.getElementById('qText');
const choicesEl = document.getElementById('choices');
const explainEl = document.getElementById('explain');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
const scoreMeta = document.getElementById('scoreMeta');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const resetBtn = document.getElementById('resetBtn');
const overlay = document.getElementById('overlay');
const resultScore = document.getElementById('resultScore');
const resultText = document.getElementById('resultText');
const reviewBtn = document.getElementById('reviewBtn');
const againBtn = document.getElementById('againBtn');

function renderQuestion(){
  const i = state.idx;
  const item = questions[i];
  qIndexEl.textContent = `ë¬¸ì œ ${i+1}`;
  qTextEl.textContent = item.q;
  choicesEl.innerHTML = '';
  explainEl.classList.remove('show');
  explainEl.textContent = '';
  // render choices
  item.choices.forEach((c, j) => {
    const d = document.createElement('div');
    d.className = 'choice';
    d.setAttribute('role','option');
    d.setAttribute('tabindex','0');
    d.dataset.choice = j;
    d.innerHTML = `<div class="label">${String.fromCharCode(65+j)}</div><div class="txt">${c}</div>`;
    d.addEventListener('click', onChoose);
    d.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); d.click(); }
    });
    choicesEl.appendChild(d);
  });

  updateProgress();
  updateNav();
  highlightAnswered();
}

function onChoose(e){
  const el = e.currentTarget;
  const choice = Number(el.dataset.choice);
  const i = state.idx;
  // if already answered for this question, reveal/allow change? We'll lock after first selection to keep ì‹¬í”Œ
  if(state.answers[i] !== null){
    // already answered, do nothing
    return;
  }

  state.answers[i] = choice;
  const correct = questions[i].answer;
  if(choice === correct){
    state.score += 1;
    el.classList.add('correct');
    showExplain(true);
    burstConfetti();
  } else {
    el.classList.add('wrong');
    // highlight correct
    const nodes = choicesEl.querySelectorAll('.choice');
    if(nodes[correct]) nodes[correct].classList.add('correct');
    showExplain(false);
  }
  updateProgress();
  // auto-enable next after small delay
  setTimeout(()=> {
    if(state.idx < questions.length -1){
      state.idx++;
      renderQuestion();
    } else {
      // show results
      showResult();
    }
  }, 700);
}

function showExplain(correct){
  const i = state.idx;
  explainEl.textContent = questions[i].explain;
  explainEl.classList.add('show');
}

function updateProgress(){
  const answered = state.answers.filter(x=> x !== null).length;
  progressText.textContent = `${answered} / ${questions.length}`;
  const percent = Math.round((answered / questions.length) * 100);
  progressBar.style.width = percent + '%';
  scoreMeta.textContent = `ì ìˆ˜: ${state.score}`;
}

function updateNav(){
  prevBtn.disabled = state.idx === 0;
  prevBtn.style.opacity = prevBtn.disabled ? 0.5 : 1;
  nextBtn.disabled = state.idx === questions.length -1;
  nextBtn.style.opacity = nextBtn.disabled ? 0.5 : 1;
}

function highlightAnswered(){
  const i = state.idx;
  const user = state.answers[i];
  const nodes = choicesEl.querySelectorAll('.choice');
  nodes.forEach((n, k) => {
    n.classList.remove('correct','wrong');
    if(user !== null){
      if(k === questions[i].answer) n.classList.add('correct');
      if(k === user && user !== questions[i].answer) n.classList.add('wrong');
      explainEl.classList.add('show');
      explainEl.textContent = questions[i].explain;
    }
  });
}

// navigation
prevBtn.addEventListener('click', ()=>{
  if(state.idx > 0){
    state.idx--;
    renderQuestion();
  }
});
nextBtn.addEventListener('click', ()=>{
  if(state.idx < questions.length -1){
    state.idx++;
    renderQuestion();
  } else {
    showResult();
  }
});
resetBtn.addEventListener('click', resetAll);

reviewBtn.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  // show first unanswered or first question
  state.idx = 0;
  renderQuestion();
});
againBtn.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  resetAll();
});

function showResult(){
  overlay.classList.add('show');
  resultScore.textContent = `${state.score} / ${questions.length}`;
  if(state.score === questions.length){
    resultText.textContent = "ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë¬¸ì œ ì •ë‹µì´ì—ìš” ğŸŒ± í™˜ê²½ ì§€ì‹ ìµœê³ !";
  } else if(state.score >= Math.ceil(questions.length * 0.7)){
    resultText.textContent = "ì˜í–ˆì–´ìš”! í™˜ê²½ì— ê´€ì‹¬ì´ ë§ë„¤ìš” â€” ë” ì•Œì•„ê°€ë´ìš”.";
  } else {
    resultText.textContent = "ì¢‹ì•„ìš”! í‹€ë¦° ë¬¸ì œ í•´ì„¤ì„ ë³´ê³  ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš”.";
  }
}

// reset / init
function resetAll(){
  state.idx = 0;
  state.answers = Array(questions.length).fill(null);
  state.score = 0;
  overlay.classList.remove('show');
  clearConfetti();
  renderQuestion();
}

// simple canvas confetti
const confettiCanvas = document.getElementById('confetti');
const ctx = confettiCanvas.getContext('2d');
let confettiPieces = [];
function resizeCanvas(){
  confettiCanvas.width = confettiCanvas.offsetWidth;
  confettiCanvas.height = confettiCanvas.offsetHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function burstConfetti(){
  // create pieces
  const count = 50;
  for(let i=0;i<count;i++){
    confettiPieces.push({
      x: Math.random() * confettiCanvas.width,
      y: -10 - Math.random()*100,
      vx: (Math.random()-0.5) * 6,
      vy: Math.random()*3 + 2,
      size: Math.random()*6 + 4,
      rot: Math.random()*360,
      color: ['#2ee6a7','#6be7ff','#7b9cff','#ffd36b'][Math.floor(Math.random()*4)],
      life: 80 + Math.random()*40
    });
  }
  if(!confettiRunning) startConfetti();
}

let confettiRunning = false;
function startConfetti(){
  confettiRunning = true;
  requestAnimationFrame(frame);
}
function clearConfetti(){
  confettiPieces = [];
  confettiRunning = false;
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
}

function frame(){
  ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  for(let i=confettiPieces.length-1;i>=0;i--){
    const p = confettiPieces[i];
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.08; // gravity
    p.rot += 6;
    p.life--;
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot * Math.PI / 180);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size * 0.6);
    ctx.restore();
    if(p.y > confettiCanvas.height + 50 || p.life <= 0) confettiPieces.splice(i,1);
  }
  if(confettiPieces.length > 0) requestAnimationFrame(frame);
  else confettiRunning = false;
}

// initial render
renderQuestion();

// keyboard shortcuts: N = next, P = prev, R = reset
document.addEventListener('keydown', (e)=>{
  if(e.key.toLowerCase() === 'n') nextBtn.click();
  if(e.key.toLowerCase() === 'p') prevBtn.click();
  if(e.key.toLowerCase() === 'r') resetBtn.click();
});
</script>
</body>
</html>
